{"version":3,"file":"terrain-worker.js","sources":["src/terrain-worker.js"],"sourcesContent":["class TerrainGenerator {\r\n  constructor (WASM, seed=123456) {\r\n    this.wasm = new Promise((resolve, reject) => WASM()\r\n      .then(result => {\r\n        this.terrainGen = new result.TerrainGenerator(seed);\r\n        resolve(true);\r\n      }).catch(reject)\r\n    );\r\n  }\r\n\r\n  async generate ({ points = 2**10, seaLevel = 0.39 }={}) {\r\n    await this.wasm;\r\n\r\n    let radius = Math.pow(500 / points, 0.5) / 10;\r\n    const world = this.terrainGen.world(radius, seaLevel).as_js_value();\r\n\r\n    world.seaLevel = seaLevel;\r\n    world.points           = world.voronoi.delaunay.points;\r\n    world.circumcenters    = world.voronoi.circumcenters;\r\n    world.voronoiAdjacency = world.voronoi.adjacent;\r\n    world.voronoiTriangles = world.voronoi.voronoi_triangles;\r\n    world.voronoiPoints    = world.voronoi.voronoi_points;\r\n\r\n    delete world.voronoi\r\n    return world;\r\n  }\r\n}\r\n\r\nlet WASM;\r\naddEventListener('message', async function (event) {\r\n  const { action, payload } = event.data;\r\n  if (action === 'init') {\r\n    WASM = payload.WASM; \r\n  \r\n  } else if (action === 'generate') {\r\n    const { seed, options } = payload;\r\n    const generator = new TerrainGenerator(WASM, seed);\r\n    console.log('generating ...')\r\n    postMessage(\r\n      'hi'\r\n      // await generator.generate(options)\r\n    );\r\n  }\r\n});\r\n\r\n"],"names":[],"mappings":";;;EAAA,MAAM,gBAAgB,CAAC;EACvB,EAAE,WAAW,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE;EAClC,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK,IAAI,EAAE;EACvD,OAAO,IAAI,CAAC,MAAM,IAAI;EACtB,QAAQ,IAAI,CAAC,UAAU,GAAG,IAAI,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;EAC5D,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC;EACtB,OAAO,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC;EACtB,KAAK,CAAC;EACN,GAAG;AACH;EACA,EAAE,MAAM,QAAQ,CAAC,CAAC,EAAE,MAAM,GAAG,CAAC,EAAE,EAAE,EAAE,QAAQ,GAAG,IAAI,EAAE,CAAC,EAAE,EAAE;EAC1D,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC;AACpB;EACA,IAAI,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,MAAM,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC;EAClD,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,WAAW,EAAE,CAAC;AACxE;EACA,IAAI,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;EAC9B,IAAI,KAAK,CAAC,MAAM,aAAa,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;EAC3D,IAAI,KAAK,CAAC,aAAa,MAAM,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC;EACzD,IAAI,KAAK,CAAC,gBAAgB,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC;EACpD,IAAI,KAAK,CAAC,gBAAgB,GAAG,KAAK,CAAC,OAAO,CAAC,iBAAiB,CAAC;EAC7D,IAAI,KAAK,CAAC,aAAa,MAAM,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC;AAC1D;EACA,IAAI,OAAO,KAAK,CAAC,QAAO;EACxB,IAAI,OAAO,KAAK,CAAC;EACjB,GAAG;EACH,CAAC;AACD;EACA,IAAI,IAAI,CAAC;EACT,gBAAgB,CAAC,SAAS,EAAE,gBAAgB,KAAK,EAAE;EACnD,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC;EACzC,EAAE,IAAI,MAAM,KAAK,MAAM,EAAE;EACzB,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;EACxB;EACA,GAAG,MAAM,IAAI,MAAM,KAAK,UAAU,EAAE;EACpC,IAAI,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;EACtC,IAAI,MAAM,SAAS,GAAG,IAAI,gBAAgB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;EACvD,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAC;EACjC,IAAI,WAAW;EACf,MAAM,IAAI;EACV;EACA,KAAK,CAAC;EACN,GAAG;EACH,CAAC,CAAC;;;;;;"}